# DS-AutoAdvisor Version 2.0 Unified Configuration
# Clear, Non-Overlapping Configuration Structure
#
# USAGE GUIDE:
# - Each script uses exactly ONE clearly marked section
# - No duplicate or overlapping configurations
# - Future extensions clearly separated from current functionality

# =============================================================================
# 🎯 ACTIVE PIPELINE CONFIGURATION
# These sections are used by the current pipeline scripts
# =============================================================================

# Used by: All pipeline scripts for global settings
global:
  project_name: "DS-AutoAdvisor Pipeline"
  version: "2.0"
  
  # Environment
  environment: "development"  # "development", "staging", "production"
  deployment_mode: "local"    # "local", "cloud", "hybrid"
  
  # Data settings
  data_input_path: "data/telco_churn_data.csv"
  target_column: "Churn"
  target_column_variants: ["Churn", "Churn_binary_0", "Churn_encoded", "Churn_label"]
  
  # Post-cleaning target override (set after data cleaning)
  post_cleaning_target:
    enabled: false
    target_column_name: "Churn_binary_0"
  
  # File settings
  csv_delimiter: ","
  csv_encoding: "utf-8"
  random_state: 42
  
  # Output
  output_base_dir: "pipeline_outputs"
  versioning_enabled: true
  metadata_store_path: "metadata/pipeline_metadata.db"
  
  # Human oversight
  human_intervention:
    enabled: true
    mode: "interactive"  # "interactive", "automated", "approval_only"
    approval_required: ["data_cleaning", "ml_advisory", "model_training"]
    confidence_thresholds:
      data_cleaning: 0.8
      ml_advisory: 0.85
      model_training: 0.9
      model_evaluation: 0.95

# Used by: 01_data_discovery.py
data_discovery:
  profiling:
    output_dir_name: "data_profiles"
    generate_html: true
    save_raw_profile: true
    enable_advanced_stats: true
    generate_data_lineage: true
    
  quality_assessment:
    enabled: true
    use_enhanced_system: true
    quality_gates: true
    automated_recommendations: true
    
    thresholds:
      completeness_min: 0.8
      consistency_min: 0.7
      validity_min: 0.9
      uniqueness_check: true
    
  config_generation:
    cleaning_config_template: true
    pipeline_config_update: true
    auto_detect_target: true
    suggest_improvements: true

# Used by: 02_data_cleaning.py (behavior only, rules in cleaning_config_template.yaml)
data_cleaning:
  execution:
    validate_before_cleaning: true
    backup_original_data: false
    generate_cleaning_report: true
    save_intermediate_steps: false
    
  quality_gates:
    enabled: true
    min_data_retention: 0.5
    max_missing_after_cleaning: 0.1
    require_target_column: true
    
  output:
    save_cleaned_data: true
    output_filename: "cleaned_data.csv"
    log_all_transformations: true
    generate_comparison_report: true

# Used by: 03_ml.py
ml_advisory:
  assumption_testing:
    enabled: true
    normality_alpha: 0.05
    homo_alpha: 0.05
    vif_threshold: 10.0
    correlation_threshold: 0.95
    verbose: true
    generate_recommendations: true
    
  model_recommendation:
    enabled: true
    include_ensemble_suggestions: true
    consider_dataset_size: true
    performance_vs_interpretability: "balanced"  # "performance", "interpretability", "balanced"
    
  meta_learning:
    enabled: true
    performance_database: "metadata/model_performance.db"
    schema_similarity_threshold: 0.8
    min_historical_samples: 5
    transfer_learning: true
    
  fairness:
    enabled: true
    protected_attributes: []
    fairness_metrics: ["demographic_parity", "equalized_odds", "calibration"]
    bias_threshold: 0.1
    mitigation_strategies: ["reweighting", "preprocessing", "postprocessing"]

# Used by: 04_model_training.py (maps directly to TrainerConfig)
model_training:
  # Data splitting
  test_size: 0.2
  validation_size: 0.1
  random_state: 42
  
  # Model selection
  max_models: 4
  include_ensemble: true
  include_advanced: true
  
  # Hyperparameter tuning
  enable_tuning: true
  tuning_method: "grid"  # "grid", "random", "none"
  tuning_iterations: 50
  tuning_cv_folds: 3
  
  # Validation
  cv_folds: 5
  scoring_strategy: "comprehensive"  # "fast", "comprehensive"
  
  # Performance
  parallel_jobs: -1
  max_training_time_minutes: 30
  memory_limit_gb: null
  
  # Preprocessing (already handled in cleaning_config_template.yaml)
  encoding_strategy: "none"   # "onehot", "label", "ordinal", "none"
  scaling_strategy: "none"    # "standard", "minmax", "robust", "none"
  
  # Business features
  enable_business_features: true
  feature_selection_enabled: true
  business_kpi_tracking: true
  business_rules_file: "config/business_rules.yaml"
  business_kpis_file: "config/business_kpis.yaml"
  
  # Output
  save_models: true
  model_dir: "models"
  save_predictions: true
  verbose: true

# Used by: 05_model_evaluation.py (maps directly to AnalysisConfig)
model_evaluation:
  # Input/Output
  models_dir: "models"
  training_report_path: "comprehensive_training_report.json"
  output_dir: "evaluation_results"
  
  # Analysis components
  enable_shap: true
  enable_learning_curves: true
  enable_residual_analysis: true
  enable_stability_analysis: true
  enable_interpretability: true
  enable_uncertainty_analysis: true
  
  # Visualization
  save_plots: true
  plot_format: "html"  # "html", "png", "both"
  plot_dpi: 300
  figure_size: [12, 8]
  
  # Performance
  n_permutations: 50
  n_bootstrap_samples: 100
  max_shap_samples: 1000
  n_models_to_evaluate: 3
  
  # 🆕 ENHANCED SHAP FEATURES
  feature_importance:
    top_k_features: 10              # Number of top features to show
    show_direction: true            # Show positive/negative impact with colors
    add_log_odds_axis: true         # Add interpretable probability scale
    permutation_error_bars: true    # Show statistical confidence intervals
  
  # 🆕 ENHANCED STABILITY ANALYSIS
  stability_testing:
    noise_levels: [0.01, 0.05, 0.1, 0.2]     # Noise robustness levels
    dropout_rates: [0.05, 0.1, 0.2, 0.3]     # Feature dropout rates
    random_state: 42                         # Reproducible results
  
  # Logging
  verbose: true
  log_level: "INFO"
# =============================================================================
# 🧪 SPECIALIZED TESTING CONFIGURATIONS
# Used by: 02_stage_testing.py for faster pipeline testing
# =============================================================================

stage_testing:
  testing_mode: "custom"  # "fast" or "custom" - controls which settings to use
  output_dir: "pipeline_outputs"
  save_intermediate_results: true
  enable_stage_inspection: true
  
  # CUSTOM MODE SETTINGS - Complete configuration for all stages
  # These settings are used when --mode custom is specified
  
  # Data Cleaning Stage Settings (custom mode)
  cleaning:
    verbose: true
    backup_original_data: false
    save_intermediate_steps: true
    
  # Advisory Stage Settings (custom mode)
  advisory:
    assumption_testing:
      verbose: true
      generate_recommendations: true
      normality_alpha: 0.05
      homo_alpha: 0.05
      vif_threshold: 10.0
      correlation_threshold: 0.95
    model_recommendation:
      enabled: true
      include_ensemble_suggestions: true
      
  # Training Stage Settings (custom mode)
  training:
    # In custom mode, specify exact models to use (overrides max_models/include_* settings)
    models_to_use: 
      - "RandomForestClassifier"
      - "GradientBoostingClassifier"
      - "XGBClassifier"
      - "LogisticRegression"
  
    max_models: 4                    # Number of models to train (used in fast mode)
    include_ensemble: false          # Include ensemble methods
    include_advanced: true           # Include advanced models (REQUIRED for XGBClassifier)
    enable_tuning: true              # Enable hyperparameter tuning
    test_size: 0.2                   # Train/test split
    validation_size: 0.1             # Validation split
    random_state: 42                 # Reproducibility
    verbose: true                    # Verbose output
    save_models: true                # Save trained models
    parallel_jobs: -1                # Use all CPU cores
    tuning_iterations: 20            # Hyperparameter tuning iterations
    
  # Evaluation Stage Settings (custom mode)
  evaluation:
    # Analysis Types
    enable_shap: true                # SHAP analysis
    enable_learning_curves: true     # Learning curve analysis
    enable_residual_analysis: true   # Residual analysis
    enable_stability_analysis: true  # Stability analysis
    enable_interpretability: true    # Interpretability analysis
    enable_uncertainty_analysis: true # Uncertainty analysis
    
    # Performance Settings
    n_permutations: 10               # Permutation importance iterations
    max_shap_samples: 200            # SHAP sample size
    n_bootstrap_samples: 25          # Bootstrap samples for stability
    n_models_to_evaluate: 3          # Number of models to evaluate
    
    # Visualization Settings
    plot_format: "html"              # "html", "png", "both"
    plot_dpi: 300                    # Plot resolution
    figure_size: [12, 8]             # Plot dimensions
    verbose: true                    # Verbose output
    
    # Enhanced Feature Importance (🆕)
    feature_importance:
      top_k_features: 8              # Number of top features to show
      show_direction: true           # Show positive/negative impact
      add_log_odds_axis: true        # Add log-odds scale
      permutation_error_bars: true   # Show confidence intervals
      
    # Enhanced Stability Testing (🆕)
    stability_testing:
      noise_levels: [0.01, 0.05]     # Noise robustness levels to test
      dropout_rates: [0.1, 0.2]      # Feature dropout rates to test
      random_state: 42               # Reproducible stability tests

# =============================================================================
# 🔧 INFRASTRUCTURE & SYSTEM SETTINGS
# =============================================================================

infrastructure:
  feature_flags:
    data_quality_v2: true
    mlflow_tracking: true
    plugin_system: true
    business_alignment: true
    metadata_tracking: true
    lineage_tracking: true
    enhanced_logging: true
  
  mlflow:
    tracking_uri: "sqlite:///mlruns/mlflow.db"
    experiment_name: "ds-autoadvisor-v2"
    artifact_location: "./mlruns"
    auto_log: true
    log_system_metrics: true
    log_artifacts: true
  
  logging:
    level: "INFO"
    structured: true
    correlation_tracking: true
    performance_metrics: true
    log_file: "logs/pipeline_v2.log"
    console_output: true
    
  plugins:
    enabled: true
    plugin_dir: "plugins"
    auto_discovery: true
    validation_required: true
    
  metadata:
    enabled: true
    store_type: "sqlite"
    connection_string: "sqlite:///metadata/pipeline_metadata.db"
    track_lineage: true
    track_performance: true
    retention_days: 90

# =============================================================================
# 🎯 BUSINESS ALIGNMENT FEATURES
# =============================================================================

business_features:
  feature_selection:
    enabled: true
    methods:
      statistical: true
      ml_based: true
      business_rules: true
    
    human_oversight:
      enabled: true
      approval_required: true
      review_stages: ["initial_selection", "ml_validation", "final_confirmation"]
    
    consistency_strategy: "intersection"  # "intersection", "union", "weighted_voting"
    min_feature_count: 5
    max_feature_count: 50
    business_rules_file: "config/business_rules.yaml"
    
  kpi_tracking:
    enabled: true
    config_file: "config/business_kpis.yaml"
    
    custom_kpis:
      revenue_impact:
        weight: 0.4
        calculation: "churn_prevention_value - false_positive_cost"
      operational_efficiency:
        weight: 0.3 
        calculation: "model_accuracy * process_automation_score"
      customer_satisfaction:
        weight: 0.3
        calculation: "customer_satisfaction_score"
    
    roi_analysis:
      enabled: true
      time_horizon_months: 12
      discount_rate: 0.10
      
    correlation_tracking:
      enabled: true
      threshold_strong: 0.7
      threshold_moderate: 0.4

# =============================================================================
# ⚙️ WORKFLOW & EXECUTION SETTINGS
# =============================================================================

workflow:
  stages: 
    - "discovery"
    - "cleaning" 
    - "advisory"
    - "training"
    - "evaluation"
  
  execution:
    parallel_execution: false
    stage_dependencies: true
    plugin_stages: ["feature_selection", "business_analysis"]
    skip_on_failure: false
    retry_attempts: 3
    
  error_handling:
    stop_on_error: false
    skip_failed_stages: true
    recovery_strategies: true
    generate_error_reports: true

# =============================================================================
# 🚀 FUTURE EXTENSIONS & ADVANCED FEATURES
# These are not yet implemented but reserved for future development
# =============================================================================

future_extensions:
  deep_learning:
    enabled: false
    frameworks: ["tensorflow", "pytorch"]
    note: "FUTURE FEATURE - Not yet implemented"
    
  cloud_execution:
    enabled: false
    provider: "aws"  # "aws", "gcp", "azure"
    instance_type: "ml.m5.large"
    max_instances: 4
    auto_scaling: true
    cost_limit_per_hour: 50.0
    note: "FUTURE FEATURE - Not yet implemented"
    
  advanced_plugins:
    sampling:
      enabled: false
      available_plugins: ["smote", "adasyn", "random_under", "tomek_links"]
      note: "FUTURE FEATURE - Basic plugins available, advanced features planned"
    
    domain_specific:
      enabled: false
      domains: ["finance", "healthcare", "marketing"]
      note: "FUTURE FEATURE - Planned for v3.0"
      
  versioning:
    models:
      enabled: false
      storage_backend: "local"
      retention_policy: "keep_best_5"
      comparison_metrics: ["accuracy", "f1_score"]
      note: "FUTURE FEATURE - Basic model saving available, versioning planned"
    reports:
      enabled: false
      version_on_config_change: true
      archive_old_versions: true
      note: "FUTURE FEATURE - Planned for v2.5"

